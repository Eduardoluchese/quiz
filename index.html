
    <!DOCTYPE html>
    <html lang="pt-BR">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Quiz Exportado</title>
      <style>
      body {
           font-family: 'Poppins', sans-serif;      
                margin: 0;
                padding: 0;
                display: flex;
                justify-content: center;
                align-items: flex-start;
                min-height: 100vh; /* Garante altura mínima de 100% */
            }
            #quiz-container {
                width: 100%; /* Ocupa toda largura */
                min-height: 100vh; /* Altura mínima de 100% da viewport */
                display: flex;
                flex-direction: column;
                align-items: center;
            }
            .quiz-section {
                display: none;
                width: 100%;
                min-height: 100vh; /* Altura mínima de 100% */
                padding: 20px 0;
                box-sizing: border-box;
            }
            .quiz-section.active {
                display: flex;
                flex-direction: column;
                align-items: center;
            }
            .content {
                width: 100%;
                max-width: 600px;
                margin: 0 auto;
                padding: 0 20px;
                box-sizing: border-box;
            }
        /* Estilos para os botões exportados */
    .mobile-button {
  position: relative;
  width: 100%;
  min-height: 65px;
  display: flex;
  align-items: center;
  border-radius: 0.75rem;
  border: 1px solid;
  font-size: 20px;
  margin-bottom: 10px;
  cursor: pointer;
  transition: background 0.3s;
}


/* Efeito de hover para mobile-button */
.mobile-button:hover {
  background: linear-gradient(45deg, var(--hover-color), var(--hover-color)) !important;
}
        .mobile-button .emoji {
          margin-left: -10px;
          font-size: 40px;
          margin-right: 20px;
          flex-shrink: 0;
        }
        .mobile-button .text {
          flex: 1;
          text-align: left; /* Alinhamento padrão */
        }
        /* Efeito de hover para mobile-button */

     
        /* Estilos para links personalizados */
        .mobile-button a {
          text-decoration: none;
          color: inherit;
          display: flex;
          align-items: center;
          width: 100%;
          height: 100%;
        }
        /* Estilos adicionais existentes */
        button {
          padding: 8px 16px;
          border: none;
          border-radius: 5px;
          background-color: #89b4fa;
          color: #1e1e2e;
          cursor: pointer;
          transition: background-color 0.3s;
        }
        button:hover {
          background-color: #b4befe;
        }
        .mobile-progress {
          width: 100%;
          margin: 15px 0;
          position: relative;
        }
        .progress-bar {
          width: 100%;
          height: 20px;
          background-color: #313244;
          border-radius: 10px;
          overflow: hidden;
        }
        .progress-fill {
          height: 100%;
          background-color: #89b4fa;
          transition: width 0.3s ease-out;
          width: 0;
        }
        .progress-value {
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          color: #ffffff;
          font-size: 12px;
          font-weight: bold;
          text-shadow: 0 0 2px rgba(0, 0, 0, 0.5);
        }
        .mobile-feedback {
          width: 100%;
          margin-bottom: 10px;
          border-radius: 10px;
          box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .feedback-container {
          padding: 15px;
          display: flex;
          align-items: flex-start;
          margin-bottom: 30px;
        }
        .feedback-image {
          width: 50px;
          height: 50px;
          border-radius: 50%;
          margin-right: 15px;
        }
        .feedback-content {
          flex: 1;
        }
        .feedback-name {
          font-weight: bold;
          margin-bottom: 2px;
        }
        .feedback-location {
          font-size: 0.9em;
          margin-bottom: 5px;
        }
        .feedback-stars {
          color: #FFD700;
          margin-bottom: 5px;
        }
        .feedback-text {
          font-style: italic;
          line-height: 1.4;
        }
/* Estilos do Widget de Celular */
.mobile-phone-widget {
          width: 100%;
          max-width: 600px;
          margin: 0 auto 10px auto;
        }
        .mobile-phone-widget .elements {
          background-color: #f9fafb;
          box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
          position: relative;
          height: 250px;
          display: flex;
          align-items: center;
          border-radius: 40px 20px 20px 40px;
          width: 100%;
          max-width: 600px;
          margin: 0 auto 30px auto;
          border: 1px solid #e5e7eb;

        }
        .mobile-phone-widget .phone-frame {
          position: absolute;
          left: 0;
          width: 120px;
          height: 96%;
          border: 6px solid black;
          border-radius: 1.5rem;
          overflow: hidden;
          margin-left:-1px;
        }
        .mobile-phone-widget .phone-frame img {
          width: 100%;
          height: 100%;
          object-fit: cover;
        }
        .mobile-phone-widget .iphone-detalhe {
          position: absolute;
          height: 10px;
          background-color: black;
          width: 60px;
          margin: 0 auto;
          border-radius: 0px 0px 40px 40px;
          left: 50%;
          transform: translateX(-50%);
          top: 0;
        }

        .mobile-phone-widget .text {
          margin-left: 140px;
          padding-right: 10px;
        }
        .mobile-phone-widget .text h2 {
          margin-top: 0;
        }
   
        .mobile-phone-widget[data-position="right"] .elements {
          border-radius: 20px 40px 40px 20px;
        }
        .mobile-phone-widget[data-position="right"] .phone-frame {
          left: auto;
          right: 0;
          margin-right: -1px;
        }
        .mobile-phone-widget[data-position="right"] .text {
          margin-left: 20px;
          margin-right: 140px;
          padding-right: 0;
        }
        .mobile-phone-widget .phone-content {
          padding: 0px;
          box-sizing: border-box;
          height: 100%;
          width: 100%;
          object-fit: cover;
        }
        .mobile-text {
          width: 100%;
          max-width: 600px;
          margin: 0 auto 10px auto;
        }

        .mobile-image {
    width: 100%;
    display: block;
    margin-bottom: 10px;
}

.mobile-image img {
    width: 100%;
    height: auto;
    display: block;
    border-radius: 1rem;
    object-fit: contain;
}
   
          /* Estilos da Nota */
.mobile-note {
  width: 100%;
  margin-bottom: 10px;
}

.notes {
  font-family: "Poppins", sans-serif;
  border-radius: 0.75rem;
  position: relative;
  background-color: #f9fafb;
  display: flex;
  padding: 15px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  border: 1px solid #e5e7eb;
}

.texts-notes {
  padding-left: 42px;
  flex: 1;
}

.icon {
  flex-shrink: 0;
}

.icon svg {
  width: 32px;
  height: 32px;
  fill: #f59e0b;
}

.title-notes {
  font-size: 1.25rem;
  font-weight: 700;
  padding-bottom: 10px;
}
.icon {
  position: absolute;
  top: 0;
  left: 0;
  margin: 10px 0px 0px 10px;
}
  /* Estilos para o Multiple Choice exportado */
.mobile-multiple-choice {
 width: 100%;
 margin-bottom: 20px;
}

.options-grid {
 display: flex;
 flex-direction: column;
 gap: 10px;
}

.option-button {
 position: relative;
 width: 100%;
 min-height: 65px;
 display: flex;
 align-items: center;
 justify-content: space-between;
 border-radius: 0.75rem;
 border: 1px solid rgb(214, 214, 214);
 background: linear-gradient(45deg, rgb(244, 244, 244), rgb(255, 255, 255));
 font-size: 20px;
 margin-bottom: 10px;
 cursor: pointer;
 padding: 0;
 transition: all 0.3s;
}

.option-content {
 display: flex;
 align-items: center;
 width: 100%;
 padding: 15px 20px;
}

.emoji {
 font-size: 40px;
 margin-right: 20px;
 margin-left: -10px;
 flex-shrink: 0;
}

.option-text {
 text-align: left;
 font-size: 1rem;
 flex: 1;
 line-height: 1.3;
}

.checkbox {
 width: 24px;
 height: 24px;
 border: 2px solid #d6d6d6;
 border-radius: 4px;
 background: white;
 position: relative;
 flex-shrink: 0;
}

.option-button.active .checkbox {
 background: #9333ea;
 border-color: #9333ea;
}

.option-button.active .checkbox::after {
 content: "";
 position: absolute;
 top: 50%;
 left: 50%;
 transform: translate(-50%, -50%) scale(1);
 width: 16px;
 height: 16px;
 background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 448 512'%3E%3Cpath fill='white' d='M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z'/%3E%3C/svg%3E");
 background-repeat: no-repeat;
 background-position: center;
}

.continue-button {
 width: 100%;
 min-height: 65px;
 border-radius: 0.75rem;
 border: none;
 background: #9333ea;
 color: white;
 font-size: 20px;
 margin-top: 20px;
 cursor: not-allowed;
 opacity: 0.5;
 transition: all 0.3s;
}

.continue-button.active {
 opacity: 1;
 cursor: pointer;
}

.continue-button:hover {
 opacity: 0.9;
}

.input-container {
  width: 100%;
  max-width: 600px;
  margin: 0 auto;
  position: relative;
  box-sizing: border-box;
}
.input-widget input.input-field {
  width: 100%;
  padding: 24px 60px;
  border: 1px solid rgb(229, 231, 235);
  border-radius: 0.75rem;
  font-size: 17px;
  background-color: rgb(249, 250, 251);
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05), 0 2px 8px rgba(0, 0, 0, 0.02);
  transition: all 0.3s;
  box-sizing: border-box;
  color: black;
  margin: 0 !important;
}
.input-field::placeholder {
  font-size: 17px;
}
.input-field:focus {
  outline: none;
  box-shadow: inset 0 0 0 2px currentColor;
}

.user-icon {
  position: absolute;
  left: 14px;
  top: 50%;
  transform: translateY(-50%);
  display: flex;
  align-items: center;
  justify-content: center;
  width: 30px;
  height: 40px;
  pointer-events: none;
}



.user-icon svg {
  height: 40px;
  fill: currentColor;
  stroke: none;
}

.user-icon svg path {
  fill: currentColor;
  stroke: none;
  stroke-width: 0;
}
.input-widget input.input-field::placeholder {
  color: var(--placeholder-color, currentColor);
  opacity: 0.5;
  font-size: 17px;
}
  /* Estilos do Video Player */
  /* Atualização dos estilos do vídeo */
      .mobile-video .container {
        container-type: inline-size;
        max-width: 600px;
        margin: 0 auto;
      }

      .mobile-video .video-container {
        position: relative;
        width: 100%;
        height: 0;
        padding-bottom: 133.33%;
        background-color: transparent;
        overflow: hidden;
        border-radius: 1rem;
      }

      .video-iframe {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 101%; /* Aumentado levemente para cobrir possíveis gaps */
        height: 101%; /* Aumentado levemente para cobrir possíveis gaps */
        transform: translate(-50%, -50%);
        border: none;
        background: #000; /* Fundo preto para espaços vazios */
      }

      .mobile-video .blur-background {
        position: absolute;
        top: -1px; /* Ajuste para eliminar gaps */
        left: -1px; /* Ajuste para eliminar gaps */
        width: calc(100% + 2px); /* Compensação para os gaps */
        height: calc(100% + 2px); /* Compensação para os gaps */
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        z-index: 199;
        display: block;
      }

      .mobile-video .overlay {
        color: #fff;
        position: absolute;
        padding: 2cqw;
        width: 50%;
        height: 40%;
        background-color: #5d3f92;
        z-index: 200;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        gap: 2cqw;
        text-align: center;
        border-radius: 8px;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
      }

    .mobile-video .overlay-title {
      font-family: Arial, sans-serif;
      font-size: 5cqw;
      font-weight: bold;
      margin: 0;
      text-transform: uppercase;
    }

    .mobile-video .overlay-text {
      font-family: Arial, sans-serif;
      font-size: 5cqw;
      margin: 0;
    }

    .mobile-video .play-icon {
      position: relative;
      height: 50%;
    }

    .mobile-video .top-overlay,
    .mobile-video .bottom-overlay {
      position: absolute;
      left: 0;
      width: 100%;
      background-color: transparent;
      z-index: 300;
      pointer-events: auto;
    }

    .mobile-video .top-overlay {
      top: 0;
      height: 20%;
    }

    .mobile-video .bottom-overlay {
      bottom: 0;
      height: 20%;
    }

    .mobile-video .hidden {
      display: none;
    }

    .mobile-video .play-icon path,
    .mobile-video .play-icon circle {
      transition: all 0.3s ease;
    }
          /* Estilos da Galeria */


.mobile-gallery {
  width: 100%;
  max-width: 600px;
  margin: 0 auto 20px;
}

.gallery-container {
  border-radius: 0.75rem;
  overflow: hidden;
  position: relative;
}

.gallery-track {
  display: flex;
  transition: transform 0.3s ease;
  width: 100%;
}

.gallery-slide {
  flex: 0 0 100%;
  width: 100%;
}

.gallery-slide img {
  width: 100%;
  height: auto;
  display: block;
}

.gallery-nav {
  display: flex;
  gap: 8px;
  justify-content: center;
  margin-top: 12px;
}

.gallery-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.25s ease;
  opacity: 1;
}

.gallery-dot.active {
  transform: scale(1.2);
}



       .mobile-button,
        .mobile-text,
        .mobile-image,
        .mobile-progress,
        .mobile-feedback,
        .mobile-phone-widget,
        .mobile-note,
        .mobile-multiple-choice,
        .input-widget,
        .mobile-video .container,
        .mobile-gallery {
          width: 100%;
          margin:0 auto;
          margin-bottom: 40px; /* Padronizando o espaçamento */
        }
      </style>
    </head>
    <body>
       <div id="quiz-container">
            <section id="section-0" class="quiz-section active" style="background-color: #ffffff">
                <div class="content" style="color: #000000;">
                    <div id="input-1735848569753" class="input-widget" style="position: relative;">
      <div class="input-container">
        <div class="user-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M224 256A128 128 0 1 0 224 0a128 128 0 1 0 0 256zm-45.7 48C79.8 304 0 383.8 0 482.3C0 498.7 13.3 512 29.7 512H418.3c16.4 0 29.7-13.3 29.7-29.7C448 383.8 368.2 304 269.7 304H178.3z" style="fill: rgb(245, 158, 11);"></path></svg>
        </div>
        <input type="text" class="input-field" placeholder="Digite o seu nome aqui" data-variable="nome" required="">
      </div>
      <button class="continue-button" disabled="" style="opacity: 0.5; cursor: not-allowed; width: 100%; min-height: 65px; border-radius: 0.75rem; border: none; background: #9333ea; color: white; font-size: 20px; margin-top: 20px;">Continuar</button>
    </div>
                </div>
            </section>
            <section id="section-1" class="quiz-section " style="background-color: #ffffff">
                <div class="content" style="color: #000000;">
                    <div id="input-1735848666836" class="input-widget" style="position: relative;">
      <div class="input-container">
        <div class="user-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M224 256A128 128 0 1 0 224 0a128 128 0 1 0 0 256zm-45.7 48C79.8 304 0 383.8 0 482.3C0 498.7 13.3 512 29.7 512H418.3c16.4 0 29.7-13.3 29.7-29.7C448 383.8 368.2 304 269.7 304H178.3z" style="fill: rgb(245, 158, 11);"></path></svg></div>
        <input type="text" class="input-field" placeholder="Digite o seu email aqui" data-variable="email" required="" style="background-color: rgb(249, 250, 251); color: rgb(0, 0, 0);">
      </div>
      <button class="continue-button" disabled="" style="opacity: 0.5; cursor: not-allowed; width: 100%; min-height: 65px; border-radius: 0.75rem; border: 1px solid rgb(255, 255, 255); background: rgb(147, 51, 234); color: rgb(0, 0, 0); font-size: 20px; margin-top: 20px; box-shadow: none; transform: none;" data-hover-color="#9333ea">Continuar</button>
    </div>
                </div>
            </section>
            <section id="section-2" class="quiz-section " style="background-color: #ffffff">
                <div class="content" style="color: #000000;">
                    <button class="mobile-button" id="button-1735848605520" style="background-color: rgb(147, 51, 166); border-color: rgb(29, 33, 39); position: relative; border-bottom-width: 1px; box-shadow: none; transform: none; opacity: 1;" data-hover-color="#9333a6" data-delay="0"><span class="emoji">😊</span><span class="text" style="color: rgb(255, 255, 255); text-align: left;">gremio</span></button><button class="mobile-button" id="button-1735848614837" style="background: linear-gradient(45deg, rgb(147, 51, 166), rgb(147, 51, 166)) rgb(147, 51, 166); border-color: rgb(29, 33, 39); position: relative; border-bottom-width: 1px; box-shadow: none; transform: none; opacity: 1;" data-hover-color="#9333a6" data-delay="0"><span class="emoji">😊</span><span class="text" style="color: rgb(255, 255, 255); text-align: left;">inter</span></button>
                </div>
            </section>
            <section id="section-3" class="quiz-section " style="background-color: #ffffff">
                <div class="content" style="color: #000000;">
                    <button class="mobile-button" id="button-1735848621661-at0vs9475" style="background-color: rgb(147, 51, 166); border-color: rgb(29, 33, 39); position: relative; border-bottom-width: 1px; box-shadow: none; transform: none; opacity: 1;" data-hover-color="#9333a6" data-delay="0"><span class="emoji">😊</span><span class="text" style="color: rgb(255, 255, 255); text-align: left;">janeiro {{city}}</span></button><button class="mobile-button" id="button-1735848621661-d72vbe2m2" style="background: linear-gradient(45deg, rgb(147, 51, 166), rgb(147, 51, 166)) rgb(147, 51, 166); border-color: rgb(29, 33, 39); position: relative; border-bottom-width: 1px; box-shadow: none; transform: none; opacity: 1;" data-hover-color="#9333a6" data-delay="0"><span class="emoji">😊</span><span class="text" style="color: rgb(255, 255, 255); text-align: left;">fevereiro</span></button><button class="mobile-button" id="button-1735848621661-vhklt8t3p" style="background-color: rgb(147, 51, 166); border-color: rgb(29, 33, 39); position: relative; border-bottom-width: 1px; box-shadow: none; transform: none; opacity: 1;" data-hover-color="#9333a6" data-delay="0"><span class="emoji">😊</span><span class="text" style="color: rgb(255, 255, 255); text-align: left;">marco</span></button>
                </div>
            </section>
            <section id="section-4" class="quiz-section " style="background-color: #ffffff">
                <div class="content" style="color: #000000;">
                    <div id="input-1735848691079" class="input-widget" style="position: relative;">
      <div class="input-container">
        <div class="user-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M224 256A128 128 0 1 0 224 0a128 128 0 1 0 0 256zm-45.7 48C79.8 304 0 383.8 0 482.3C0 498.7 13.3 512 29.7 512H418.3c16.4 0 29.7-13.3 29.7-29.7C448 383.8 368.2 304 269.7 304H178.3z" style="fill: rgb(245, 158, 11);"></path></svg></div>
        <input type="text" class="input-field" placeholder="Digite o seu whatsapp aqui {{city}}" data-variable="whatsapp" required="" style="background-color: rgb(249, 250, 251); color: rgb(0, 0, 0);">
      </div>
      <button class="continue-button" disabled="" style="opacity: 0.5; cursor: not-allowed; width: 100%; min-height: 65px; border-radius: 0.75rem; border: 1px solid rgb(255, 255, 255); background: rgb(147, 51, 234); color: rgb(0, 0, 0); font-size: 20px; margin-top: 20px; box-shadow: none; transform: none;" data-hover-color="#9333ea">Continuar</button>
    </div>
                </div>
            </section>
  </div>
  <script>
  
    const connectionsData = [{"startIndex":0,"endIndex":1,"elementId":"input-1735848569753"},{"startIndex":2,"endIndex":3,"elementId":"button-1735848605520"},{"startIndex":2,"endIndex":3,"elementId":"button-1735848614837"},{"startIndex":1,"endIndex":4,"elementId":"input-1735848666836"},{"startIndex":4,"endIndex":2,"elementId":"input-1735848691079"}];
  /*************************************************************
     * 1) CONFIGURAÇÃO DO WEBHOOK E INFORMAÇÕES DO QUIZ
     *************************************************************/
  const ANALYTICS_CONFIG = {
    webhookUrl: "https://script.google.com/macros/s/AKfycbz8C1Sp8GQJdGrHNH8sgNHLDkiT3KDQodhQbC2qhdc_4_wo6VWInUnpZXPkl-TEbMqz/exec", // Substitua pela URL do seu Google Apps Script
    quizId: "quiz_" + Date.now(),
    quizName: "Meu Quiz de Teste",
    quizCategory: "Teste"
  };

  /*************************************************************
   * 2) OBJETO PRINCIPAL DE ANALYTICS
   *************************************************************/
  const quizAnalytics = {
    quizId: ANALYTICS_CONFIG.quizId,
    quizName: ANALYTICS_CONFIG.quizName,
    quizCategory: ANALYTICS_CONFIG.quizCategory,
    userId: "user_" + Date.now() + "_" + Math.random().toString(36).substr(2, 9),
    sessionId: "session_" + Date.now(),
    startTime: Date.now(),
    endTime: null,
    furthestSection: "section-0",
    responses: {},
    city: "",
    // Campos opcionais para inputs (nome, email, whatsapp)
    nome: "",
    email: "",
    whatsapp: ""
  };

  /*************************************************************
   * 3) FUNÇÃO PARA ENVIAR OS DADOS PARA O WEBHOOK
   *************************************************************/
async function sendAnalytics() {
  try {
    // Sincronizar userVariables com quizAnalytics
    quizAnalytics.nome = userVariables.nome || "";
    quizAnalytics.email = userVariables.email || "";
    quizAnalytics.whatsapp = userVariables.whatsapp || "";
    quizAnalytics.city = quizAnalytics.city || "Desconhecida"; // Garantir que a cidade esteja definida

    const dataToSend = [ quizAnalytics ];

    await fetch(ANALYTICS_CONFIG.webhookUrl, {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: new URLSearchParams({
        'data': JSON.stringify(dataToSend)
      })
    });
    console.log("Analytics enviado com sucesso.");
  } catch (error) {
    console.error("Erro ao enviar analytics:", error);
  }
}


      /*************************************************************
       * 4) QUANDO SAIR DA PÁGINA (beforeunload), ENVIA DADOS
       *************************************************************/
   window.addEventListener("beforeunload", () => {
  quizAnalytics.endTime = Date.now();

  // Sincronizar userVariables com quizAnalytics
  quizAnalytics.nome = userVariables.nome || "";
  quizAnalytics.email = userVariables.email || "";
  quizAnalytics.whatsapp = userVariables.whatsapp || "";

  const dataToSend = [quizAnalytics];
  const blob = new Blob(
    [new URLSearchParams({ data: JSON.stringify(dataToSend) })],
    { type: "application/x-www-form-urlencoded" }
  );
  navigator.sendBeacon(ANALYTICS_CONFIG.webhookUrl, blob);
});
      // gravar respostas
      document.addEventListener("click", function (e) {
        const button = e.target.closest(".mobile-button");
        if (button) {
          const buttonId = button.id;
          const connection = connectionsData.find(
            (conn) => conn.elementId === buttonId
          );
          if (connection) {
            // Supondo que cada botão representa uma resposta
            const sectionId = connection.startIndex;
            const resposta = button.querySelector(".text").textContent;
            quizAnalytics.responses["section_" + sectionId] = resposta;

            showSection("section-" + connection.endIndex);
          }
          const link = button.getAttribute("data-link");
          if (link) {
            window.location.href = link;
          }
        }
      });

      // Flag para garantir que fetchUserCity seja chamada apenas uma vez
let cityFetched = false;

/*************************************************************
 * FUNÇÃO PARA BUSCAR A CIDADE DO USUÁRIO
 *************************************************************/
async function fetchUserCity() {
  if (cityFetched) return; // Evita múltiplas chamadas
  cityFetched = true; // Marca que a cidade já foi buscada

  console.log('Iniciando fetchUserCity...');
  try {
    const response = await fetch('https://geolocation-db.com/json/');
    console.log('Resposta da API:', response);
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    const data = await response.json();
    console.log('Dados da API:', data);
    
    if (data && data.city) {
      quizAnalytics.city = data.city;
      console.log('Cidade do usuário:', data.city);
    } else {
      console.error('Falha ao obter a cidade.');
      quizAnalytics.city = 'Desconhecida';
    }
  } catch (error) {
    console.error('Erro ao buscar a cidade:', error);
    quizAnalytics.city = 'Desconhecida';
  }
}




 function setupDelayedButtons(section) {
  const buttons = section.querySelectorAll('.mobile-button[data-delay]');
  buttons.forEach(button => {
    button.style.opacity = "0";
    button.style.transition = "opacity 0.3s ease";
    const delay = parseFloat(button.getAttribute('data-delay')) * 1000;
    setTimeout(() => {
      button.style.opacity = "1";
    }, delay);
  });
}

function showSection(sectionId) {
  console.log('Showing section:', sectionId);

  // Remove 'active' de todas as seções e para o autoplay de galerias
  const sections = document.querySelectorAll('.quiz-section');
  sections.forEach(section => {
    section.classList.remove('active');
    section.querySelectorAll('.mobile-gallery').forEach(gallery => {
      if (gallery.galleryInstance) {
        gallery.galleryInstance.stopAutoplay();
      }
    });
    // Ocultar botões
    const buttons = section.querySelectorAll('.mobile-button');
    buttons.forEach(button => {
      button.style.opacity = '0';
      button.style.transition = 'none';
          fetchUserCity();

    });
  });

  // Acha a seção alvo
  const targetSection = document.getElementById(sectionId);
  if (targetSection) {
    // Torna a seção ativa
    targetSection.classList.add('active');

    // -------------------------------------------------------------
    //  FORÇAR A ROLAGEM PARA O TOPO  (3 tentativas)
    // -------------------------------------------------------------
    window.scrollTo({ top: 0, behavior: 'auto' });
    document.documentElement.scrollTop = 0;
    document.body.scrollTop = 0;

    // Exibir botões (com ou sem delay)
    setupDelayedButtons(targetSection);
    const regularButtons = targetSection.querySelectorAll('.mobile-button:not([data-delay])');
    regularButtons.forEach(button => {
      button.style.opacity = '1';
      button.style.transition = 'opacity 0.3s ease';
    });

    // Chamadas extras: progress bars, inputs, etc.
    animateProgressBars(targetSection);
    interpolateVariables(targetSection);
    setupInputWidget(targetSection.querySelector('.input-widget'));
    initializeGalleries(targetSection);
                // Buscar a cidade do usuário
  fetchUserCity();

  // Atualiza furthestSection se necessário
      const indexNow = parseInt(sectionId.split('-')[1]) || 0;
      const indexFurthest = parseInt(quizAnalytics.furthestSection.split('-')[1]) || 0;
      if (indexNow > indexFurthest) {
        quizAnalytics.furthestSection = sectionId;
      }
    }
  }



    function handleProgressCompletion(progressElement) {
      const enableRedirect = progressElement.getAttribute('data-enable-redirect') === 'true';
      if (enableRedirect) {
        setTimeout(function() {
          const redirectLink = progressElement.getAttribute('data-redirect-link');
          if (redirectLink) {
            window.location.href = redirectLink;
          } else {
            const connection = connectionsData.find(function(conn) { return conn.elementId === progressElement.id; });
            if (connection) {
              showSection('section-' + connection.endIndex);
            }
          }
        }, 1000);
      }
    }

    function animateProgressBars(section) {
      const progressBars = section.querySelectorAll('.mobile-progress');
      progressBars.forEach(function(progress) {
        const progressBar = progress.querySelector('.progress-fill');
        const progressValue = progress.querySelector('.progress-value');
        const start = parseInt(progress.getAttribute('data-start')) || 0;
        const end = parseInt(progress.getAttribute('data-end')) || 100;
        const enableRedirect = progress.getAttribute('data-enable-redirect') === 'true';
        const duration = parseInt(progress.getAttribute('data-duration')) || 1;
        console.log('Animating progress bar:', progress.id, 'from', start, 'to', end, 'duration:', duration);
        progressBar.style.width = start + '%';
        progressValue.textContent = start + '%';
        var current = start;
        var increment = (end - start) / (duration * 50); // 50 fps
        var interval = setInterval(function() {
          current += increment;
          if (current >= end) {
            current = end;
            clearInterval(interval);
            console.log('Progress bar reached 100%');
            if (enableRedirect) {
              handleProgressCompletion(progress);
            }
          }
          progressBar.style.width = current + '%';
          progressValue.textContent = Math.round(current) + '%';
        }, 20);
      });
    }

    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM fully loaded');
      const firstSection = document.querySelector('.quiz-section');
      if (firstSection) {
        console.log('Activating first section');
        firstSection.classList.add('active');
        animateProgressBars(firstSection);
      }
    });

    document.addEventListener('click', function(e) {
      const button = e.target.closest('.button');
      if (button) {
        const onclick = button.getAttribute('onclick');
        if (onclick) {
          console.log('Button clicked, executing:', onclick);
          eval(onclick);
        }
      }
    });

    document.addEventListener('click', function(e) {
      const button = e.target.closest('.mobile-button');
      if (button) {
        const buttonId = button.id;
        const connection = connectionsData.find(conn => conn.elementId === buttonId);
        if (connection) {
          showSection('section-' + connection.endIndex);
        }
        const link = button.getAttribute('data-link');
        if (link) {
          window.location.href = link;
        }
      }
    });

    document.querySelectorAll('.mobile-button').forEach(function(button) {
      const anchor = document.createElement('a');
      anchor.href = 'javascript:void(0);';
      anchor.style.display = 'flex';
      anchor.style.alignItems = 'center';
      anchor.style.width = '100%';
      anchor.style.height = '100%';
      while (button.firstChild) {
        anchor.appendChild(button.firstChild);
      }
      button.appendChild(anchor);
    });

    document.querySelectorAll('.mobile-button').forEach(function(button) {
      const hoverColor = button.getAttribute('data-hover-color');
      if (hoverColor) {
        button.style.setProperty('--hover-color', hoverColor);
      }
    });

    document.addEventListener("DOMContentLoaded", function() {
      const delayedButtons = document.querySelectorAll(".mobile-button[data-delay]");
      delayedButtons.forEach(button => {
        button.style.opacity = "0";
        const delay = parseFloat(button.getAttribute("data-delay")) * 1000;
        setTimeout(() => {
          button.style.opacity = "1";
          button.style.transition = "opacity 0.3s ease";
        }, delay);
      });
    });

         document.addEventListener('DOMContentLoaded', function() {
        function resetMultipleChoice(widget) {
          const options = widget.querySelectorAll('.option-button');
          const continueButton = widget.querySelector('.continue-button');
          const continueColor = continueButton.style.backgroundColor;
          const checkboxColor = options[0]?.querySelector('.checkbox')?.style.borderColor || '#d6d6d6';

          options.forEach(option => {
            const clone = option.cloneNode(true);
            option.parentNode.replaceChild(clone, option);
          });

          const clonedButton = continueButton.cloneNode(true);
          continueButton.parentNode.replaceChild(clonedButton, continueButton);

          widget.querySelectorAll('.option-button').forEach(option => {
            option.classList.remove('active');
            const checkbox = option.querySelector('.checkbox');
            if (checkbox) {
              checkbox.style.backgroundColor = '';
              checkbox.style.borderColor = checkboxColor;
            }
          });

          clonedButton.classList.remove('active');
          clonedButton.style.opacity = '0.5';
          clonedButton.style.cursor = 'not-allowed';

          return { 
            options: widget.querySelectorAll('.option-button'), 
            continueButton: clonedButton,
            continueColor,
            checkboxColor
          };
        }

        const setupMultipleChoice = () => {
          document.querySelectorAll('.mobile-multiple-choice').forEach(widget => {
            const { options, continueButton, continueColor, checkboxColor } = resetMultipleChoice(widget);

            function updateContinueButton(widget, continueButton) {
              const selectedCount = widget.querySelectorAll('.option-button.active').length;
              const isActive = selectedCount > 0;
              
              continueButton.classList.toggle('active', isActive);
              continueButton.style.opacity = isActive ? '1' : '0.5';
              continueButton.style.cursor = isActive ? 'pointer' : 'not-allowed';
              return selectedCount;
            }

            function handleOptionClick(e) {
              e.preventDefault();
              this.classList.toggle('active');
              const checkbox = this.querySelector('.checkbox');
              
              if (this.classList.contains('active')) {
                checkbox.style.backgroundColor = checkboxColor;
                checkbox.style.borderColor = checkboxColor;
              } else {
                checkbox.style.backgroundColor = '';
                checkbox.style.borderColor = checkboxColor;
              }

              updateContinueButton(widget, continueButton);
            }

            options.forEach(option => {
              option.addEventListener('click', handleOptionClick);
            });

            continueButton.addEventListener('click', () => {
              const selectedCount = widget.querySelectorAll('.option-button.active').length;
              if (selectedCount > 0) {
                const connection = connectionsData.find(conn => conn.elementId === widget.id);
                if (connection) {
                  showSection('section-' + connection.endIndex);
                }
              }
            });
          });
        };

        setupMultipleChoice();


      // Mutation Observer para detectar mudanças de seção
      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          if (mutation.target.classList.contains('active')) {
            setupMultipleChoice();
            setupInputWidget(mutation.target.querySelector('.input-widget'));
          }
        });
      });

      document.querySelectorAll('.quiz-section').forEach((section) => {
        observer.observe(section, { attributes: true, attributeFilter: ['class'] });
      });
    });

    // Sistema de variáveis
// Sistema de variáveis
let userVariables = JSON.parse(sessionStorage.getItem('userVariables') || '{}');

function setupInputWidget(widget) {
  if (!widget) return;
  
  const input = widget.querySelector('.input-field');
  const button = widget.querySelector('.continue-button');
  const variable = input.getAttribute('data-variable');

  button.disabled = true;
  button.style.opacity = '0.5';
  button.style.cursor = 'not-allowed';
  
  if (userVariables[variable]) {
    input.value = userVariables[variable];
    button.disabled = false;
    button.style.opacity = '1';
    button.style.cursor = 'pointer';
  }
  
  input.addEventListener('input', function() {
    const hasValue = this.value.trim().length > 0;
    button.disabled = !hasValue;
    button.style.opacity = hasValue ? '1' : '0.5';
    button.style.cursor = hasValue ? 'pointer' : 'not-allowed';

    userVariables[variable] = this.value;
    sessionStorage.setItem('userVariables', JSON.stringify(userVariables));
  });

  button.addEventListener('click', function() {
    if (input.value.trim().length > 0) {
      const connection = connectionsData.find(conn => conn.elementId === widget.id);
      if (connection) {
        showSection('section-' + connection.endIndex);
      }
    }
  });
}
function interpolateVariables(section) {
  const textNodes = Array.from(section.getElementsByTagName('*'))
    .filter(el => !el.children.length && el.textContent.includes('{{'))
    .map(el => ({element: el, original: el.textContent}));

  textNodes.forEach(({element, original}) => {
    let text = original;
    const matches = text.match(/{{([^}]+)}}/g) || [];
    
    matches.forEach(match => {
      const variable = match.slice(2, -2).trim();
      const value = userVariables[variable] || quizAnalytics[variable] || '';
      text = text.replace(match, value);
    });

    element.textContent = text;
  });
}



function showSection(sectionId) {
  const sections = document.querySelectorAll('.quiz-section');
  sections.forEach(section => {
    section.classList.remove('active');
  });
  
  const targetSection = document.getElementById(sectionId);
  if (targetSection) {
    targetSection.classList.add('active');
    interpolateVariables(targetSection);
    setupDelayedButtons(targetSection);
    animateProgressBars(targetSection);
    setupInputWidget(targetSection.querySelector('.input-widget'));
  }
     const indexNow = parseInt(sectionId.split("-")[1]) || 0;
  const indexFurthest =
    parseInt(quizAnalytics.furthestSection.split("-")[1]) || 0;
  if (indexNow > indexFurthest) {
    quizAnalytics.furthestSection = sectionId;}
}

document.addEventListener('DOMContentLoaded', function() {
  const firstSection = document.querySelector('.quiz-section');
  if (firstSection) {
    firstSection.classList.add('active');
    interpolateVariables(firstSection);
    animateProgressBars(firstSection);
    setupInputWidget(firstSection.querySelector('.input-widget'));
  }
});

    document.querySelectorAll('.input-widget').forEach(setupInputWidget);

  </script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
      // Objeto para armazenar todos os players
      const videoPlayers = new Map();

      function initializeVideo(videoDiv) {
        const uniqueId = videoDiv.id.split('-')[1];
        const startOverlay = videoDiv.querySelector(`#start-overlay-${uniqueId}`);
        const pauseOverlay = videoDiv.querySelector(`#pause-overlay-${uniqueId}`);
        const blurBg = videoDiv.querySelector(`#blur-bg-${uniqueId}`);
        const iframe = videoDiv.querySelector(`#youtube-video-${uniqueId}`);

        if (!iframe) return;

        const player = new YT.Player(`youtube-video-${uniqueId}`, {
          events: {
            onReady: function() {
              startOverlay.style.display = "flex";
              blurBg.style.display = "block";

              startOverlay.onclick = () => {
                player.playVideo();
                startOverlay.style.display = "none";
                blurBg.style.display = "none";
              };

              pauseOverlay.onclick = () => {
                player.playVideo();
                pauseOverlay.style.display = "none";
                blurBg.style.display = "none";
              };
            },
            onStateChange: function(event) {
              if (event.data === YT.PlayerState.PAUSED) {
                pauseOverlay.style.display = "flex";
                blurBg.style.display = "block";
              } else if (event.data === YT.PlayerState.ENDED) {
                startOverlay.style.display = "flex";
                pauseOverlay.style.display = "none";
                blurBg.style.display = "block";
              } else if (event.data === YT.PlayerState.PLAYING) {
                startOverlay.style.display = "none";
                pauseOverlay.style.display = "none";
                blurBg.style.display = "none";
              }
            }
          }
        });

        // Armazena o player para uso posterior
        videoPlayers.set(uniqueId, player);
      }

      function onYouTubeIframeAPIReady() {
        // Inicializa todos os vídeos presentes na página
        document.querySelectorAll('.mobile-video').forEach(videoDiv => {
          initializeVideo(videoDiv);
        });
      }

      // Observa mudanças nas seções para inicializar novos vídeos
      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          if (mutation.target.classList.contains('active')) {
            mutation.target.querySelectorAll('.mobile-video').forEach(videoDiv => {
              if (!videoPlayers.has(videoDiv.id.split('-')[1])) {
                initializeVideo(videoDiv);
              }
            });
          }
        });
      });

      document.querySelectorAll('.quiz-section').forEach((section) => {
        observer.observe(section, { 
          attributes: true, 
          attributeFilter: ['class'],
          subtree: true
        });
      });   
      
            // Inicializa todas as galerias
    class Gallery {
      constructor(element) {
        this.gallery = element;
        this.track = element.querySelector(".gallery-track");
        this.slides = [...element.querySelectorAll(".gallery-slide")];
        this.dots = [...element.querySelectorAll(".gallery-dot")];
        this.currentSlide = 0;
        this.autoplayInterval = null;

        // Obtém as cores definidas no estilo inline dos dots
        const dots = element.querySelectorAll(".gallery-dot");
        const firstDot = dots[0];
        const secondDot = dots[1];
        
        // Usa as cores definidas nos atributos style ou cores padrão
        this.dotActiveColor = firstDot?.style.backgroundColor || "#9333ea";
        this.dotColor = secondDot?.style.backgroundColor || "#ccc";

        // Configura dots com cores e escala corretas imediatamente
        this.dots.forEach((dot, index) => {
          dot.style.transition = "all 0.3s ease";
          this.updateDotStyle(dot, index === 0);
        });

        // Setup de eventos
        this.dots.forEach((dot, index) => {
          dot.addEventListener("click", () => this.goToSlide(index));
        });

        this.touchStartX = 0;
        this.touchEndX = 0;

        this.track.addEventListener("touchstart", (e) => this.touchStart(e));
        this.track.addEventListener("touchmove", (e) => this.touchMove(e));
        this.track.addEventListener("touchend", (e) => this.touchEnd(e));

        this.track.addEventListener("mouseenter", () => this.stopAutoplay());
        this.track.addEventListener("mouseleave", () => this.startAutoplay());

        // Força atualização imediata dos dots
        this.updateDotColors();
        this.startAutoplay();
      }

      updateDotStyle(dot, isActive) {
        dot.style.backgroundColor = isActive ? this.dotActiveColor : this.dotColor;
        dot.style.transform = isActive ? "scale(1.2)" : "scale(1)";
      }

      updateDotColors() {
        this.dots.forEach((dot, index) => {
          this.updateDotStyle(dot, index === this.currentSlide);
        });
      }

      startAutoplay() {
        this.stopAutoplay();
        this.autoplayInterval = setInterval(() => this.next(), 3000);
      }

      stopAutoplay() {
        if (this.autoplayInterval) {
          clearInterval(this.autoplayInterval);
          this.autoplayInterval = null;
        }
      }

      updateSlide() {
        this.track.style.transition = "transform 0.3s ease";
        this.track.style.transform = `translateX(-${this.currentSlide * 100}%)`;
        this.updateDotColors();
      }

      next() {
        this.currentSlide = (this.currentSlide + 1) % this.slides.length;
        this.updateSlide();
      }

      prev() {
        this.currentSlide = (this.currentSlide - 1 + this.slides.length) % this.slides.length;
        this.updateSlide();
      }

      goToSlide(index) {
        this.currentSlide = index;
        this.updateSlide();
        this.stopAutoplay();
        this.startAutoplay();
      }

      touchStart(e) {
        this.touchStartX = e.touches[0].clientX;
        this.stopAutoplay();
        this.track.style.transition = "none";
      }

      touchMove(e) {
        if (!this.touchStartX) return;
        e.preventDefault();
        const currentX = e.touches[0].clientX;
        const diff = this.touchStartX - currentX;
        const moveX = -(diff + this.currentSlide * this.gallery.offsetWidth);
        this.track.style.transform = `translateX(${moveX}px)`;
      }

      touchEnd(e) {
        const touchEndX = e.changedTouches[0].clientX;
        const diff = this.touchStartX - touchEndX;

        if (Math.abs(diff) > 50) {
          if (diff > 0) this.next();
          else this.prev();
        } else {
          this.updateSlide();
        }

        this.touchStartX = 0;
        this.startAutoplay();
      }
    }

    // Função para inicializar galerias em um container específico
    function initializeGalleries(container = document) {
      container.querySelectorAll('.mobile-gallery').forEach(gallery => {
        const existingGallery = gallery.galleryInstance;
        if (existingGallery) {
          existingGallery.stopAutoplay();
        }
        gallery.galleryInstance = new Gallery(gallery);
      });
    }

    // Atualiza a função showSection para incluir inicialização de galerias
    function showSection(sectionId) {
      const sections = document.querySelectorAll('.quiz-section');
      sections.forEach(section => {
        section.querySelectorAll('.mobile-gallery').forEach(gallery => {
          if (gallery.galleryInstance) {
            gallery.galleryInstance.stopAutoplay();
          }
        });
        section.classList.remove('active');
            fetchUserCity();

      });
      
      const targetSection = document.getElementById(sectionId);
      if (targetSection) {
        targetSection.classList.add('active');
        interpolateVariables(targetSection);
        setupDelayedButtons(targetSection);
        animateProgressBars(targetSection);
        setupInputWidget(targetSection.querySelector('.input-widget'));
        initializeGalleries(targetSection);
      }

         const indexNow = parseInt(sectionId.split("-")[1]) || 0;
  const indexFurthest =
    parseInt(quizAnalytics.furthestSection.split("-")[1]) || 0;
  if (indexNow > indexFurthest) {
    quizAnalytics.furthestSection = sectionId;}
    }

    // Inicializa tudo quando o DOM carregar
    document.addEventListener('DOMContentLoaded', function() {
      // Inicializa galerias na primeira seção
      const firstSection = document.querySelector('.quiz-section');
      if (firstSection) {
        firstSection.classList.add('active');
        initializeGalleries(firstSection);
        interpolateVariables(firstSection);
        animateProgressBars(firstSection);
        setupInputWidget(firstSection.querySelector('.input-widget'));
      }

      // Observa mudanças nas seções
      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          if (mutation.target.classList.contains('active')) {
            initializeGalleries(mutation.target);
          }
        });
      });

      document.querySelectorAll('.quiz-section').forEach((section) => {
        observer.observe(section, { 
          attributes: true, 
          attributeFilter: ['class']
        });
      });
    });
    </script>
  </body>
  </html>
